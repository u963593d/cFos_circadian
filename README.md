# cFos_circadian
These codes analyze the circadian rhythmicity of c-Fos expression in mouse whole-brain samples and make figures.

## requirements
* Python 3.10
* Gspread
* Oauth2client
* Numpy
* Scipy
* Pandas
* Matplotlib
* Statsmodels
* Multiprocess
* Tifffile
* Gzip
* Nibabel
* Numba
* Scikit-image
* Scikit-learn
* Cupy
* Python-opencv
* Seaborn

* ANTs 2.5.0


If you would like to analyze based on cell count at voxel level, you need to install the followings compatible with your GPU. 
* CUDA toolkit
* NVIDIA HPC SDK (https://hpcworld.jp/nvidia-hpc-sdk-install/)

# Steps and Codes
## 1. Image normalization by ANTs
`$ANTs_image.ipynb` normalizes nuclear and c-Fos staining images of mouse whole brains cleared by CUBIC-R+
CUBIC-R+ atlas is provided by the URL().

## 2. AI-based cell detection
`$AI-based cell detection.ipynb` deconvolves c-Fos staining images and detect candidates for c-Fos positive cells. It also predicts candidates by machine-learning.
It needs GPU to calculate distances between PSF and candidates.

## 3. Rhythmicity analysis of regional c-Fos expression
`$.ipynb` analyze the rhythmicity of regional c-Fos expression by analytic cosinor test.
The original source of analytic cosinor test is [here](https://github.com/OrganismalSystemsBiology/analytic_cosinor)

## 4. Voxel-wise Rhythmicity analysis of c-Fos expression
`$.py` analyze voxel-wise rhythmicity of c-Fos expression. 
Figures for voxel-wise analysis are generated by `$.py`.

## 5. Time prediction by timetable method
`$.ipynb` predict the internal time of a brain sample by timetable method.
The details about timetable method are shown in [Ueda et al](https://www.pnas.org/doi/10.1073/pnas.0401882101).

## 6. Time prediction by CYCLOPS 2.0
`$.ipynb` predict the internal time of a brain sample by CYCLOPS 2.0.
The details about CYCLOPS 2.0 are shown in [Anafi et al](https://www.pnas.org/doi/10.1073/pnas.1619320114).

## Contact
K. Yamashita  kyamashita276@gmail.com

<br>
F. L. Kinoshita  kinoshita.lee@gmail.com

If you utilize this code in your research, please cite the following original paper:
A whole-brain single-cell atlas of circadian neural activity in mice.
K. Yamashita et al. Under review.
